# EmoHeal 2.0 - 情感反馈多模态生成系统

## 版本更新说明

### 2.0版本更新内容 (2025-06-09)

1. **视频时长优化**
   - 视频时长从30秒延长至45秒，提供更完整的情感体验
   - 优化音乐生成参数，支持更长时间的高质量音乐

2. **多图片幻灯片功能**
   - 支持生成多张图片（默认9张），每5秒切换一次
   - 为每张图片添加细微变化，确保视觉多样性
   - 保持情感一致性的同时提供更丰富的视觉体验

3. **字幕功能**
   - 自动为语音添加字幕，增强可理解性
   - 字幕与图片切换同步，每张图片显示对应的文本部分
   - 支持中英文字幕自动分段

4. **情感一致性优化**
   - 确保音乐、图片、语音和字幕在情感表达上保持一致
   - 优化各模态间的时长匹配，避免割裂感

5. **技术改进**
   - 优化音乐生成参数，提高长音乐的连贯性
   - 改进视频合成流程，支持多图片幻灯片和字幕
   - 优化资源使用，提高生成效率

## 使用说明

### 安装依赖

```bash
pip install -r requirements.txt
```

### 运行Web应用

```bash
python app.py
```

### 命令行使用

```bash
cd qm_final
python Emo_LLM/full_pipeline.py --input "你的输入文本" --output_dir "输出目录"
```

## 系统架构

EmoHeal是一个多模态情感反馈系统，包含以下组件：

1. **情感分析模块** - 基于LLaMA的情感分析和响应生成
2. **图像生成模块** - 基于Playground v2.5的情感图像生成
3. **语音合成模块** - 基于ChatTTS的情感语音合成
4. **音乐生成模块** - 基于ACEStep的情感音乐生成
5. **多模态整合模块** - 将图像、语音和音乐合成为视频

## 注意事项

- 首次运行时需要下载模型，可能需要较长时间
- 生成过程较为耗时，请耐心等待
- 确保有足够的GPU内存（推荐至少8GB）

## 系统功能

系统由以下几个模块组成：

1. **情感理解模块 (Emo_LLM)**: 分析用户输入的文本，生成情感标签和多模态提示词
2. **文本到图像模块 (TTI)**: 根据提示词生成相关图像
3. **文本到语音模块 (TTS)**: 根据语音文本生成语音内容
4. **文本到音乐模块 (TTM)**: 根据音乐提示词生成音乐
5. **多模态集成模块**: 将图像、语音和音乐合成为最终视频

## 使用方法

### Web界面

系统提供了一个友好的Web界面，可以通过以下方式启动：

#### Windows用户

双击运行 `run_webapp.bat` 文件，将自动启动Web服务器。

#### Linux/Mac用户

在终端中执行：

```bash
chmod +x run_webapp.sh
./run_webapp.sh
```

启动后，在浏览器中访问 `http://localhost:5000` 即可使用Web界面：

1. 在文本框中输入您想要转换的文字
2. 点击"生成视频"按钮
3. 等待处理完成（会显示进度动画）
4. 生成的视频会直接在页面上显示，可以立即播放

### 命令行界面

除了Web界面外，系统还提供命令行方式使用：

#### 交互模式

```bash
python -m Emo_LLM.full_pipeline --interactive
```

#### 单次处理模式

```bash
python -m Emo_LLM.full_pipeline --input "您的输入文本" --output_dir output_videos
```

## 依赖安装

安装所需的依赖包：

```bash
pip install -r requirements.txt
```

## 系统要求

- Python 3.8+
- 确保已安装所有必要的Python包
- 足够的磁盘空间用于存储生成的媒体文件

## 目录结构

- `Emo_LLM/`: 情感理解模块
- `TTI/`: 文本到图像模块
- `TTS/`: 文本到语音模块
- `TTM/`: 文本到音乐模块
- `integration2/`: 多模态集成模块
- `templates/`: Web界面模板
- `static/`: 静态资源文件
- `app.py`: Flask Web应用
- `run_webapp.bat/sh`: 启动脚本 